name: Test Simple Automation

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Test Auto Implementation
      uses: actions/github-script@v7
      with:
        script: |
          console.log('ğŸ§ª Testing auto-implementation feature');
          
          // Issueæ¤œç´¢
          const issues = await github.rest.issues.listForRepo({
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: 'claude-processed',
            state: 'open',
            per_page: 5
          });
          
          console.log(`Found ${issues.data.length} issues with claude-processed label`);
          
          for (const issue of issues.data) {
            console.log(`Issue #${issue.number}: ${issue.title}`);
            
            // åŸºæœ¬çš„ãªãƒ–ãƒ©ãƒ³ãƒæ¤œç´¢
            const branches = await github.rest.repos.listBranches({
              owner: context.repo.owner,
              repo: context.repo.repo,
              per_page: 10
            });
            
            const issueNum = issue.number.toString();
            const matchingBranches = branches.data.filter(branch => 
              branch.name.toLowerCase().includes(`issue-${issueNum}`) ||
              (branch.name.toLowerCase().includes('claude') && branch.name.includes(issueNum))
            );
            
            if (matchingBranches.length === 0) {
              console.log(`âš ï¸ No branch found for Issue #${issue.number} - Would start auto-implementation`);
              
              // ãƒ†ã‚¹ãƒˆã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                body: 'ğŸ§ª **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­** - æœªç€æ‰‹Issueè‡ªå‹•å®Ÿè£…æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚\n\nå®Ÿéš›ã®å®Ÿè£…ã¯è¡Œã„ã¾ã›ã‚“ãŒã€ã“ã®æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚'
              });
            } else {
              console.log(`âœ… Found ${matchingBranches.length} branch(es) for Issue #${issue.number}`);
            }
          }