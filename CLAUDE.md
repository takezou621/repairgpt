# RepairGPT - Claude Code Assistant Instructions

**Note**: このプロジェクトではClaude Code Max (Opus 4)を使用しています。

## プロジェクト概要

RepairGPT は、AI を活用して電子機器の修理をサポートするオープンソースプロジェクトです。LLM とマルチモーダル機能を使用して、ゲーム機、スマートフォン、PC などの消費者向け電子機器の診断と修理を支援します。

 - ❌ 「完了！」「成功！」の安易な報告を止める
  - ✅ 実際の動作確認後にのみ結果を報告する
  - ✅ 失敗や制約は隠さず正直に伝える

  2. 手動作業を「自動化成功」と偽装しない

  - ❌ 手動でPR作成して「自動化達成」と言わない
  - ✅ 手動介入が必要な場合は明確に「手動作業が必要」と報告
  - ✅ 部分的な成功と完全な成功を明確に区別する

  3. 技術制約を受け入れる

  - ❌ 不可能なことを「可能」と言い張らない
  - ✅ GitHub Actions の権限制約など技術的限界を認める
  - ✅ 代替案提示時は制約も含めて説明する

  4. テスト駆動で作業する

  - ❌ 実装後に「きっと動く」と仮定しない
  - ✅ 実装→即座にテスト→結果確認→報告の順序を徹底
  - ✅ テスト失敗時は素直に「失敗しました」と報告

  5. 学習履歴を活用する

  - ✅ 過去の失敗パターンを記録し、同じ過ちを避ける
  - ✅ 「今度こそ」ではなく「前回失敗した理由を踏まえて」と考える

## 技術スタック

### バックエンド
- **言語**: Python 3.9+
- **Webフレームワーク**: FastAPI 0.100+
- **データベース**: PostgreSQL 14+ (本番)、SQLite (開発)
- **ORM**: SQLAlchemy 2.0+
- **キャッシュ**: Redis 7.0+

### フロントエンド
- **UI**: Streamlit 1.25+
- **カスタムコンポーネント**: HTML/CSS/JavaScript

### AI/ML
- **LLM**: OpenAI GPT-4、Claude-3
- **Vision API**: OpenAI Vision API
- **プロンプト管理**: LangChain
- **画像処理**: Pillow、OpenCV

### 外部サービス
- **iFixit API**: 修理手順データ
- **OpenAI API**: 自然言語処理
- **Claude API**: 高度な推論

## プロジェクト構造

```
repairgpt/
├── README.md               # プロジェクト概要
├── docs/                   # 包括的なドキュメント
│   ├── architecture/       # アーキテクチャ設計
│   ├── setup/             # セットアップガイド
│   ├── specs/             # 仕様書
│   ├── api/               # API仕様
│   ├── development/       # 開発ガイド
│   └── deployment/        # デプロイメント
├── src/                   # ソースコード（未実装）
├── tests/                 # テストコード（未実装）
└── config/                # 設定ファイル（未実装）
```

## 開発ガイドライン

### コーディング規約
1. **Python コード**:
   - PEP 8 に準拠
   - 型ヒントを使用
   - docstring でドキュメント化

2. **ファイル命名**:
   - スネークケース使用（例: `repair_service.py`）
   - 明確で説明的な名前

3. **API設計**:
   - RESTful 原則に従う
   - Pydantic モデルで入力検証
   - 適切なエラーハンドリング

### セキュリティ要件
- JWT トークン認証
- 入力データの厳密な検証
- HTTPS/TLS 通信
- 環境変数でシークレット管理

## 主要機能

### 実装予定の機能
1. **テキスト診断**: デバイスの問題をテキストで説明し、診断結果を取得
2. **画像診断**: デバイスの写真をアップロードして問題を特定
3. **修理ガイド生成**: iFixit スタイルの段階的な修理手順
4. **部品・工具推奨**: 必要な部品と工具のリスト
5. **コミュニティ Q&A**: ユーザー間の知識共有

### データフロー
1. ユーザーがテキストまたは画像で問題を入力
2. AI が問題を分析・診断
3. iFixit API と統合して修理手順を取得
4. カスタマイズされた修理ガイドを生成
5. 結果をキャッシュして高速化

## テスト戦略
- **Unit Tests**: pytest で個々のコンポーネントをテスト
- **Integration Tests**: API エンドポイントの統合テスト
- **Performance Tests**: 負荷テストとレスポンス時間測定
- **Coverage**: 80% 以上のコードカバレッジを目標

## デプロイメント
- **コンテナ化**: Docker
- **オーケストレーション**: Kubernetes
- **CI/CD**: GitHub Actions
- **監視**: Prometheus + Grafana
- **ログ**: 構造化ログ (JSON形式)

## 開発コマンド

### 環境構築
```bash
# 仮想環境作成
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 依存関係インストール
pip install -r requirements.txt

# 開発用データベース初期化
python scripts/init_db.py
```

### 開発サーバー起動
```bash
# FastAPI サーバー
uvicorn src.main:app --reload --port 8000

# Streamlit UI
streamlit run src/ui/app.py --server.port 8501
```

### テスト実行
```bash
# 全テスト実行
pytest

# カバレッジ付きテスト
pytest --cov=src tests/

# 特定のテストのみ
pytest tests/test_repair_service.py
```

### コード品質チェック
```bash
# リンター
flake8 src/

# 型チェック
mypy src/

# フォーマッター
black src/
```

## 注意事項

1. **API キー管理**: OpenAI、Claude、iFixit の API キーは環境変数で管理
2. **データプライバシー**: ユーザーのデバイス情報は適切に匿名化
3. **レート制限**: 外部 API のレート制限に注意
4. **エラーハンドリング**: ユーザーフレンドリーなエラーメッセージ

## 貢献ガイドライン

1. **Issue 作成**: バグ報告や機能提案は GitHub Issues で
2. **ブランチ戦略**: `feature/`、`bugfix/`、`hotfix/` プレフィックス使用
3. **Pull Request**: レビュー前にテストとリンターを実行
4. **コミットメッセージ**: 明確で説明的なメッセージ

## 将来の拡張計画

### 短期目標（3-6ヶ月）
- マルチモーダル対応（音声入力・出力）
- リアルタイム通信（WebSocket）
- モバイル対応（PWA）

### 中長期目標（6-12ヶ月）
- マイクロサービス化
- カスタム AI モデルの訓練
- グローバル展開（多言語対応）

## リソース

- [プロジェクトドキュメント](docs/README.md)
- [アーキテクチャ概要](docs/architecture/architecture_overview.md)
- [API仕様書](docs/api/api_specification.md)
- [開発ガイドライン](docs/development/development_guidelines.md)

---

最終更新日: 2025-01-12

## 自動化フローテスト

自動化ワークフローの動作確認テスト (Issue #20) - 2025-07-12
真の100%完全自動化の最終テスト実装 (Issue #24) - 2025-07-13
完全自動化証明完了: #午後

### 夜間自動化システム実装 (Issue #32) - 2025-07-13

**現実的自動化レベル達成:**
- ✅ Claude Code: ブランチ作成・実装完了
- ✅ 夜間自動PR作成: 新システム実装
- ✅ 夜間自動マージ: スケジュール最適化  
- ✅ Issue自動クローズ: 夜間バッチ処理
- ✅ パフォーマンス最適化: 重複ワークフロー統合

**技術改善:**
- 毎分実行→夜間3回実行への最適化
- GitHub API制限回避
- リソース使用量削減
- エラーハンドリング強化

**実行時刻:** 2025-07-13 夜間自動化システム完成

### 夜間自動化システム動作テスト (Issue #33) - 2025-07-13

**テスト実装完了:**
- ✅ Claude Code: テストブランチ作成・実装完了
- 🌙 夜間自動化システム: 動作確認準備完了
- 📝 テスト実行: 夜間ワークフロー手動トリガー予定
- 🔄 全自動化フロー: PR作成→マージ→クローズ→削除

**実行時刻:** 2025-07-13 テスト実装完了 - 夜間自動化テスト準備完了

### 夜間自動化システム動作検証 (Issue #36) - 2025-07-13

**完全動作検証実装:**
- ✅ Claude Code: 検証ブランチ作成・実装完了
- 🌙 夜間自動化システム: 完全動作テスト実行
- 📊 検証項目: PR作成→マージ→クローズ→削除の全フロー
- 🔍 システム監視: ワークフロー実行状況の詳細確認

**検証環境:**
- 夜間自動化ワークフロー: claude-night-automation.yml
- スケジュール: 23:00, 02:00, 05:00 JST
- 手動トリガー: workflow_dispatch対応

**実行時刻:** 2025-07-13 動作検証実装完了 - 完全自動化テスト開始
