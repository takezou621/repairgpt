# QAテストコマンド

このコマンドは、qa-engineer-testerエージェントを使用して、包括的な品質保証テストを実行し、バグを特定して修正提案を行います。

## 使用方法
```
/qa-test <feature-or-component>
```

## 動作内容
1. 対象機能の包括的なテストシナリオを作成
2. 機能テスト、エッジケーステスト、パフォーマンステストを実行
3. セキュリティ脆弱性をチェック
4. 発見された問題に対する修正案を提供
5. リグレッションテストを実行

## エージェント実行
```
Task(
    description="Execute comprehensive QA testing",
    prompt=f"""
    qa-engineer-testerエージェントとして、以下の機能/コンポーネントの包括的なQAテストを実行してください：
    
    対象: {user_input}
    
    以下のテスト戦略で品質保証を行ってください：
    
    1. **機能テスト**
       - 正常系のシナリオテスト
       - ユーザーストーリーベースのテスト
       - API エンドポイントテスト
       - UI/UX の動作確認
    
    2. **エッジケーステスト**
       - 境界値テスト
       - 異常な入力値のテスト
       - 空値、null、undefined の処理
       - 大量データの処理
       - 同時実行/並行処理
    
    3. **エラーハンドリングテスト**
       - 例外処理の動作確認
       - エラーメッセージの適切性
       - フォールバック機能
       - リトライロジック
    
    4. **パフォーマンステスト**
       - レスポンスタイム測定
       - メモリ使用量分析
       - CPU使用率チェック
       - スケーラビリティテスト
       - 負荷テスト（同時接続数）
    
    5. **セキュリティテスト**
       - 認証・認可のテスト
       - SQLインジェクション
       - XSS脆弱性
       - CSRF対策
       - データ暗号化
    
    6. **統合テスト**
       - 外部API連携（iFixit API）
       - データベース操作
       - キャッシュ機能
       - 非同期処理
    
    7. **RepairGPT固有のテスト**
       - 修理手順の安全性警告表示
       - 多言語対応（日本語/英語切り替え）
       - デバイス別の修理ガイド精度
       - 画像分析の精度
    
    各問題に対して：
    - 再現手順を明確に記載
    - 影響範囲を特定
    - 優先度を設定（Critical/High/Medium/Low）
    - 具体的な修正コードを提案
    - 修正後の検証方法を提示
    
    出力形式：
    1. テスト実行サマリー
    2. 発見された問題のリスト（優先度順）
    3. 各問題の詳細と修正提案
    4. パフォーマンスメトリクス
    5. セキュリティ評価
    6. 改善推奨事項
    """,
    subagent_type="qa-engineer-tester"
)
```

## 使用例
```
/qa-test 修理ガイド生成API
/qa-test 画像アップロード機能
/qa-test ユーザー認証システム
/qa-test iFixit API統合
```

## 期待される出力
```markdown
# QAテストレポート

## テスト実行サマリー
- **実行日時**: 2025-07-26 14:30
- **対象**: 修理ガイド生成API
- **実行テスト数**: 156
- **成功**: 142
- **失敗**: 14
- **カバレッジ**: 92%

## 発見された問題

### 🔴 Critical (1件)
#### 1. メモリリークの可能性
- **場所**: src/services/image_analysis.py:89
- **症状**: 大量画像処理時にメモリが解放されない
- **再現手順**:
  1. 10MB以上の画像を連続で100枚アップロード
  2. メモリ使用量が継続的に増加
- **修正提案**:
  ```python
  # 現在のコード
  processed_images.append(process_image(img))
  
  # 修正案
  processed_image = process_image(img)
  processed_images.append(processed_image)
  del img  # 明示的にメモリ解放
  gc.collect()  # 必要に応じてガベージコレクション
  ```

### 🟠 High (3件)
#### 2. レート制限なしのAPI呼び出し
- **場所**: src/clients/ifixit_client.py:45
- **影響**: iFixit APIのレート制限でブロックされる可能性
- **修正提案**: レート制限機能の実装（例: 60回/分）

### 🟡 Medium (5件)
#### 3. 不適切なエラーメッセージ
- **場所**: src/api/routes/repair_guides.py:78
- **問題**: 技術的すぎるエラーメッセージがユーザーに表示
- **修正案**: ユーザーフレンドリーなメッセージに変更

### 🟢 Low (5件)
#### 4. パフォーマンス最適化の機会
- **提案**: 頻繁にアクセスされるデータのキャッシュ実装

## パフォーマンスメトリクス
- **平均レスポンスタイム**: 245ms
- **95パーセンタイル**: 890ms
- **最大同時接続数**: 1000
- **メモリ使用量**: 平均512MB、ピーク時2.1GB

## セキュリティ評価
- ✅ SQL インジェクション: 対策済み
- ✅ XSS: 対策済み
- ⚠️ レート制限: 未実装
- ✅ 認証/認可: JWT実装済み

## 改善推奨事項
1. **即座に対応すべき項目**
   - メモリリークの修正
   - レート制限の実装

2. **次のスプリントで対応**
   - エラーメッセージの改善
   - キャッシュ戦略の実装

3. **長期的な改善**
   - パフォーマンステストの自動化
   - カオスエンジニアリングの導入
```

## 補足情報
- テストは本番環境を模した環境で実行
- 自動修正可能な問題はPRを作成
- CI/CDパイプラインへの統合を推奨